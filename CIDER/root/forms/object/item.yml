method: post

form_error_message: Sorry, there was in error in your submission. Please see below.

model_config:
    resultset: Item

default_args:
    elements:
        Textarea:
            rows: 8

elements:
    - type: Hidden
      name: id

    - type: Hidden
      name: parent

    - label: Item Number
      name: number
      constraints:
        - type: Required
        - type: DBIC::Unique
          resultset: Object
          id_field: id
          message: Number is already in use

    - label: Item Title
      name: title
      constraints:
        - type: Required

    - type: Hidden
      name: creator_count
    - type: Fieldset
      legend: Creators
      elements:
        - type: Repeatable
          nested_name: item_creators
          counter_name: creator_count
          model_config:
            empty_rows: 1
          elements:
            - type: Hidden
              name: id
            - type: Select
              name: name
              empty_first: 1
              model_config:
                resultset: AuthorityName
                delete_if_empty: 1

    - type: Fieldset
      legend: Date
      elements:            
          - type: Checkbox
            label: Circa
            name: circa

          - label: From
            name: date_from
            constraints:
            # Date is temporarily not required, while importing legacy data.
              - &Date
                type: Callback
                callback: 'CIDER::Logic::Utils::iso_8601_date'
                message: ISO 8601 date must be YYYY, YYYY-MM, or YYYY-MM-DD

          - label: To
            name: date_to
            constraint: *Date

    - type: Select
      label: Restrictions
      name: restrictions
      model_config:
        resultset: ItemRestrictions
        label_column: description
        attributes:
          order_by: id

    - name: accession_number
      label: Accession Number

    - type: Select
      label: Type
      name: dc_type
      constraint: Required
      model_config:
        resultset: DCType
        attributes:
          order_by: name

    - type: Hidden
      name: personal_name_count
    - type: Fieldset
      legend: Personal Names
      elements:
        - type: Repeatable
          nested_name: item_personal_names
          counter_name: personal_name_count
          model_config:
            empty_rows: 1
          elements:
            - type: Hidden
              name: id
            - type: Select
              name: name
              empty_first: 1
              model_config:
                resultset: AuthorityName
                delete_if_empty: 1

    - type: Hidden
      name: corporate_name_count
    - type: Fieldset
      legend: Corporate Names
      elements:
        - type: Repeatable
          nested_name: item_corporate_names
          counter_name: corporate_name_count
          model_config:
            empty_rows: 1
          elements:
            - type: Hidden
              name: id
            - type: Select
              name: name
              empty_first: 1
              model_config:
                resultset: AuthorityName
                delete_if_empty: 1

    - type: Hidden
      name: topic_term_count
    - type: Fieldset
      legend: Topic Terms
      elements:
        - type: Repeatable
          nested_name: item_topic_terms
          counter_name: topic_term_count
          model_config:
            empty_rows: 1
          elements:
            - type: Hidden
              name: id
            - type: Select
              name: term
              empty_first: 1
              model_config:
                resultset: TopicTerm
                delete_if_empty: 1

    - type: Hidden
      name: geographic_term_count
    - type: Fieldset
      legend: Geographic Terms
      elements:
        - type: Repeatable
          nested_name: item_geographic_terms
          counter_name: geographic_term_count
          model_config:
            empty_rows: 1
          elements:
            - type: Hidden
              name: id
            - type: Select
              name: term
              empty_first: 1
              model_config:
                resultset: GeographicTerm
                delete_if_empty: 1

    - type: Textarea
      label: Description
      name: description

    - type: Fieldset
      id: accordion
      elements:
        - type: Block
          tag: h3
          elements:
            - type: Block
              tag: a
              attributes:
                href: '#serial-publication'
              content: Serial Publication
        - type: Block
          elements:
            - name: volume
              label: Volume

            - name: issue
              label: Issue

        - type: Block
          tag: h3
          elements:
            - type: Block
              tag: a
              attributes:
                href: '#scholarship'
              content: Scholarship
        - type: Block
          elements:
            - type: Textarea
              name: abstract
              label: Abstract

            - type: Textarea
              name: citation
              label: Bibliographic Citation
      
    - type: Block
      tag: h2
      content: Classes

    - type: Block
      attributes:
        class: required_message
      content_xml: "<p>Click class label to expand</p>"
      

    - type: Fieldset
      legend: Groups
      elements:
        - type: Hidden
          name: group_count
        - type: Repeatable
          nested_name: groups
          counter_name: group_count
          # TO DO: there's no editable elements in a Group, so there's
          # no way to add one with empty_rows.
          elements:
            - type: Hidden
              name: id
            - type: Label
              name: volume
              label: Volume

    - type: Fieldset
      elements:
        - type: Block
          tag: legend
          id: file_folders_expand_button
          attributes:
             class: 'button'
          content: 'File Folders'
        - type: Hidden
          name: file_folder_count
        - type: Repeatable
          nested_name: file_folders
          counter_name: file_folder_count
          model_config:
            empty_rows: 1
          elements:
            - type: Block
              attributes:
                 class: 'file_folders_form'
              elements:
                - type: Hidden
                  name: id
                - type: Select
                  name: location
                  label: Location
                  empty_first: 1
                  model_config:
                    resultset: Location
                    delete_if_empty: 1 
                - type: Label
                  name: format
                  label: Format
                - type: Textarea
                  name: notes
                  label: Notes

    - type: Fieldset
      elements:
        - type: Block
          tag: legend
          id: containers_expand_button
          attributes:
             class: 'button'
          content: 'Container'
        - type: Hidden
          name: container_count
        - type: Repeatable
          nested_name: containers
          counter_name: container_count
          model_config:
            empty_rows: 1
          elements:
            - type: Block
              attributes:
                class: 'containers_form'
              elements:
                 - type: Hidden
                   name: id
                 - type: Select
                   name: location
                   label: Location
                   empty_first: 1
                   model_config:
                     resultset: Location
                     delete_if_empty: 1 
                 - type: Select
                   name: format
                   label: Format
                   empty_first: 1
                   model_config:
                     resultset: Format
                     condition:
                       class: container
                 - type: Textarea
                   name: notes
                   label: Notes

    - type: Fieldset
      elements:
        - type: Block
          tag: legend
          id: bound_volumes_expand_button
          attributes:
              class: button
          content: Bound Volumes
        - type: Hidden
          name: bound_volume_count
        - type: Repeatable
          nested_name: bound_volumes
          counter_name: bound_volume_count
          model_config:
            empty_rows: 1
          elements: 
            - type: Block
              attributes:
                class: 'bound_volumes_form'
              elements:
                - type: Hidden
                  name: id
                - type: Select
                  name: location
                  label: Location
                  empty_first: 1
                  model_config:
                    resultset: Location
                    delete_if_empty: 1 
                - type: Select
                  name: format
                  label: Format
                  empty_first: 1
                  model_config:
                    resultset: Format
                    condition:
                       class: bound_volume
                - type: Textarea
                  name: notes
                  label: Notes
                - type: Textarea
                  name: rights
                  label: Rights

    - type: Fieldset
      elements:
        - type: Block
          tag: legend
          id: three_dimensional_objects_expand_button
          attributes:
             class: button
          content: "Three Dimensional Objects"
        - type: Hidden
          name: three_dimensional_object_count
        - type: Repeatable
          nested_name: three_dimensional_objects
          counter_name: three_dimensional_object_count
          model_config:
            empty_rows: 1
          elements:
            - type: Block
              attributes:
                class: 'three_dimensional_objects_form'
              elements:
                - type: Hidden
                  name: id
                - type: Select
                  name: location
                  label: Location
                  empty_first: 1
                  model_config:
                    resultset: Location
                    delete_if_empty: 1 
                - type: Select
                  name: format
                  label: Format
                  empty_first: 1
                  model_config:
                    resultset: Format
                    condition:
                       class: three_dimensional_object
                - type: Textarea
                  name: notes
                  label: Notes
                - type: Textarea
                  name: rights
                  label: Rights

    - type: Fieldset
      elements:
        - type: Block
          tag: legend
          id: audio_visual_media_expand_button
          attributes:
             class: button
          content: Audio Visual Media 
        - type: Hidden
          name: audio_visual_media_count
        - type: Repeatable
          nested_name: audio_visual_media
          counter_name: audio_visual_media_count
          model_config:
            empty_rows: 1
          elements: 
            - type: Block
              attributes:
                class: audio_visual_media_form
              elements:
                - type: Hidden
                  name: id
                - type: Select
                  name: location
                  label: Location
                  empty_first: 1
                  model_config:
                    resultset: Location
                    delete_if_empty: 1 
                - type: Select
                  name: format
                  label: Format
                  empty_first: 1
                  model_config:
                    resultset: Format
                    condition:
                      class: audio_visual_media
                - type: Textarea
                  name: notes
                  label: Notes
                - type: Textarea
                  name: rights
                  label: Rights

    - type: Fieldset
      elements:
        - type: Block
          tag: legend
          id: documents_expand_button
          attributes:
              class: button
          content: Documents
        - type: Hidden
          name: document_count
        - type: Repeatable
          nested_name: documents
          counter_name: document_count
          model_config:
            empty_rows: 1
          elements:
            - type: Block
              attributes:
                class: documents_form
              elements:
                - type: Hidden
                  name: id
                - type: Select
                  name: location
                  label: Location
                  empty_first: 1
                  model_config:
                    resultset: Location
                    delete_if_empty: 1 
                - type: Select
                  name: format
                  label: Format
                  empty_first: 1
                  model_config:
                    resultset: Format
                    condition:
                      class: document
                - name: dimensions
                  label: Dimensions
                - type: Textarea
                  name: rights
                  label: Rights

    - type: Fieldset
      elements:
        - type: Block
          tag: legend
          id: physical_images_expand_button
          attributes:
             class: button
          content: Physical Images
        - type: Hidden
          name: physical_image_count
        - type: Repeatable
          nested_name: physical_images
          counter_name: physical_image_count
          model_config:
            empty_rows: 1
          elements:
            - type: Block
              attributes:
                class: physical_images_form
              elements:
                - type: Hidden
                  name: id
                - type: Select
                  name: location
                  label: Location
                  empty_first: 1
                  model_config:
                    resultset: Location
                    delete_if_empty: 1 
                - type: Select
                  name: format
                  label: Format
                  empty_first: 1
                  model_config:
                    resultset: Format
                    condition:
                       class: physical_image
                - name: dimensions
                  label: Dimensions
                - type: Textarea
                  name: rights
                  label: Rights

    - type: Fieldset
      elements:
        - type: Block
          tag: legend
          id: digital_objects_expand_button
          attributes:
             class: button
          content: Digital Objects
        - type: Hidden
          name: digital_object_count
        - type: Repeatable
          nested_name: digital_objects
          counter_name: digital_object_count
          model_config:
            empty_rows: 1
          elements: 
            - type: Block
              attributes:
                 class: digital_objects_form
              elements:
                - type: Hidden
                  name: id
                - type: Fieldset
                  elements:
                    - type: Select
                      name: location
                      label: Location
                      empty_first: 1
                      model_config:
                        resultset: Location
                        delete_if_empty: 1 
                    - type: Select
                      name: format
                      label: Format
                      empty_first: 1
                      model_config:
                         resultset: Format
                         condition:
                            class: digital_object
                    - name: pid
                      label: PID
                      # constraints:
                      # TO DO: this doesn't seem to do anything.
                      # - type: DependOn
                      #   others: location
                    - name: permanent_url
                      label: Permanent URL
                      constraint:
                        type: Regex
                        common:
                          - URI
                          - HTTP
                          - { '-scheme': 'https?' }
                    - type: Textarea
                      name: notes
                      label: Notes
                    - type: Textarea
                      name: rights
                      label: Rights

                    - type: Fieldset
                      legend: Relationships
                      elements:
                        - type: Hidden
                          name: relationship_count

                        - type: Repeatable
                          nested_name: digital_object_relationships
                          counter_name: relationship_count
                          model_config:
                            empty_rows: 1
                          elements:
                            - type: Hidden
                              name: id

                            - type: Select
                              label: Predicate
                              name: predicate
                              # TO DO: these constraints don't seem to
                              # work when nested this way?
                              # constraint:
                              #   - type: DependOn
                              #     others: pid
                              empty_first: 1
                              model_config:
                                  delete_if_empty: 1
                                  resultset: RelationshipPredicate
                              attributes:
                                  order_by: id

                            - name: pid
                              label: PID
                              # constraint:
                              #   - type: DependOn
                              #     others: predicate

                    - name: checksum
                      label: Checksum
                    - type: Select
                      name: file_extension
                      label: File Extension
                      empty_first: 1
                      model_config:
                           resultset: FileExtension
                    - name: original_filename
                      label: Original Filename
                    - type: Textarea
                      name: toc
                      label: Table of Contents

                    - type: Fieldset
                      legend: Stabilization
                      elements:
                        - type: Select
                          name: stabilized_by
                          label: By
                          empty_first: 1
                          model_config:
                             resultset: Staff
                             label_column: full_name
                          attributes:
                             order_by:
                                - last_name
                                - first_name
                        - name: stabilization_date
                          label: Date
                          constraint: *Date
                        - type: Select
                          name: stabilization_procedure
                          label: Procedure
                          empty_first: 1
                          model_config:
                             resultset: StabilizationProcedure
                             label_column: name
                        - type: Textarea
                          name: notes
                          label: Notes

                    - type: Fieldset
                      legend: Applications
                      elements:
                        - type: Select
                          name: checksum_app
                          label: Checksum
                          model_config:
                             resultset: Application
                             condition:
                               function: checksum
                        - type: Select
                          name: media_app
                          label: Media Image
                          model_config:
                             resultset: Application
                             condition:
                                function: media_image
                        - type: Select
                          name: virus_app
                          label: Virus Check
                          model_config:
                             resultset: Application
                             condition:
                                function: virus_check
                        - type: Hidden
                          name: other_app_count
                        - type: Fieldset
                          legend: Other
                          elements:
                            - type: Repeatable
                              nested_name: other_apps
                              counter_name: other_app_count
                              model_config:
                                empty_rows: 1
                              elements:
                                 - name: application
                                   model_config:
                                      delete_if_empty: 1

                    - name: file_creation_date
                      label: File Creation Date
                      constraint: *Date

    - type: Fieldset
      elements:
        - type: Block
          tag: legend
          id: browsing_objects_expand_button
          attributes:
             class: button
          content: Browsing Objects
        - type: Hidden
          name: browsing_object_count
        - type: Repeatable
          nested_name: browsing_objects
          counter_name: browsing_object_count
          model_config:
            empty_rows: 1
          elements:
            - type: Block
              attributes:
                class: browsing_objects_form
              elements:
                - type: Hidden
                  name: id
                - type: Select
                  name: format
                  label: Format
                  empty_first: 1
                  model_config:
                     resultset: Format
                     condition:
                        class: browsing_object
                - name: pid
                  label: PID
                  model_config:
                    delete_if_empty: 1
                - name: thumbnail_pid
                  label: Thumbnail PID

                - type: Fieldset
                  legend: Relationships
                  elements:
                    - type: Hidden
                      name: relationship_count

                    - type: Repeatable
                      nested_name: browsing_object_relationships
                      counter_name: relationship_count
                      model_config:
                        empty_rows: 1
                      elements:
                        - type: Hidden
                          name: id

                        - type: Select
                          name: predicate
                          label: Predicate
                          # constraint:
                          #   - type: DependOn
                          #     others: pid
                          empty_first: 1
                          model_config:
                            delete_if_empty: 1
                            resultset: RelationshipPredicate
                            attributes:
                               order_by: id

                        - name: pid
                          label: PID
                          # constraint:
                          #   - type: DependOn
                          #     others: predicate

    - type: Submit
      name: submit
